var z=Object.defineProperty;var w=(n,r,t)=>r in n?z(n,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[r]=t;var c=(n,r,t)=>(w(n,typeof r!="symbol"?r+"":r,t),t),y=(n,r,t)=>{if(!r.has(n))throw TypeError("Cannot "+t)};var p=(n,r,t)=>(y(n,r,"read from private field"),t?t.call(n):r.get(n)),g=(n,r,t)=>{if(r.has(n))throw TypeError("Cannot add the same private member more than once");r instanceof WeakSet?r.add(n):r.set(n,t)},m=(n,r,t,i)=>(y(n,r,"write to private field"),i?i.call(n,t):r.set(n,t),t);(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function t(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(e){if(e.ep)return;e.ep=!0;const o=t(e);fetch(e.href,o)}})();function $(n,r){let t=0;return function(...i){const e=Date.now();if(!(e-t<r))return t=e,n(...i)}}var u,f,_;class x extends HTMLElement{constructor(){super();c(this,"_size");c(this,"_prizes_dom");c(this,"_trigger_dom");c(this,"_playing");c(this,"_old_position",0);c(this,"_old_dge",0);c(this,"_transitionDuration",5e3);c(this,"_type","wheel");c(this,"_default_html");g(this,u,void 0);g(this,f,void 0);g(this,_,void 0)}init(){this.disconnect(),this.style.display="block",this.style.position="relative",this._size=Math.min(this.offsetWidth,this.offsetHeight),this._prizes_dom=this.querySelector('[title*="prizes"]'),this._trigger_dom=this.querySelector('[title*="trigger"]'),this._default_html=this.innerHTML,m(this,_,new ResizeObserver(([t])=>{if(this._playing===!0)return;const i=t.target;this._size=Math.min(i.offsetWidth,this.offsetHeight),this._playing=!1,this.relayout()})),p(this,_).observe(this),m(this,u,new MutationObserver(t=>{this._playing!==!0&&t.forEach(i=>{i.type==="childList"&&this.relayout()})})),p(this,u).observe(this._prizes_dom,{attributes:!0,childList:!0,subtree:!0}),m(this,f,new MutationObserver($(([t])=>{t.type==="attributes"&&this.handleAttributes(t.attributeName)},200))),p(this,f).observe(this,{childList:!1,attributes:!0})}disconnect(){var t,i,e;(t=p(this,u))==null||t.disconnect(),(i=p(this,f))==null||i.disconnect(),(e=p(this,_))==null||e.disconnect()}connectedCallback(){this.init(),this.getType(),this.relayout(),this.handleLoad()}disconnectedCallback(){this.disconnect()}handleAttributes(t){this._playing!==!0&&(t==="prize"&&this.lotter(),t==="type"&&(this._default_html&&(this.innerHTML=this._default_html),this.init(),this.getType(),this.relayout()))}getType(){const t=this.getAttribute("type");this._type=["wheel","grid"].includes(t)?t:"wheel"}handleEnded(t){this.dispatchEvent(new CustomEvent("ended",{bubbles:!0,composed:!0,detail:t}))}handlePlay(t){this.dispatchEvent(new CustomEvent("play",{bubbles:!0,composed:!0,detail:t}))}handleLoad(){this.dispatchEvent(new CustomEvent("load",{bubbles:!0,composed:!0}))}wheelLotter({elements:t,prize:i,position:e}){const d=360/t.length,h=`${this._transitionDuration}ms`,l=6;let s=d*e*-1;s+=360*l,s=s+this._old_dge,this._old_dge=(s-s%360)%360,this._prizes_dom.style.transitionDuration=h,this._prizes_dom.style.transform=`rotate(${s}deg)`;const a=()=>{this._prizes_dom.style.transitionDuration="0s",this._prizes_dom.style.transform=`rotate(${s%360}deg)`,this.handleEnded(i),this._prizes_dom.removeEventListener("transitionend",a),this._playing=!1};this._prizes_dom.addEventListener("transitionend",a)}gridLotter({elements:t,prize:i,position:e}){const o=t.length;let h=o*5+e,l=300,s=this._old_position;this._old_position=e;const a=()=>{s>=h?(this._playing=!1,this.handleEnded(i),l=300):(s<o*2+this._old_position&&(l>30?(console.log(l),l-=30):l=30),s>h-o*2&&(l+=10),s+=1,t.forEach(b=>b.classList.remove("activeclass")),t[s%t.length].classList.add("activeclass"),setTimeout(a,l))};a()}lotter(){const t=this.getAttribute("prize");if(t){this._playing=!0,this.handlePlay(t);const i=Array.from(this._prizes_dom.children);let e;if(i.some((o,d)=>{o.getAttribute("title")===t&&(e=d)}),e===void 0)throw this._playing=!1,new Error("Unable to locate the prize element!");this._type==="grid"&&this.gridLotter({elements:i,position:e,prize:t}),this._type==="wheel"&&this.wheelLotter({elements:i,position:e,prize:t})}}relayout(){this.relayoutPrizes(),this.relayoutTrigger()}relayoutPrizes(){this._type==="wheel"&&this.relayoutWheelPrizes(),this._type==="grid"&&this.relayoutGridPrizes()}relayoutGridPrizes(){if(!this._prizes_dom)return;const t=this._prizes_dom.style;t.position="absolute",t.padding="0",t.margin="0",t.left="0",t.top="0",t.boxSizing="border-box",t.width="100%",t.height="100%",t.overflow="hidden";const i=Array.from(this._prizes_dom.children),e=Math.ceil(i.length/4),o=this._size/(e+1);i.forEach((d,h)=>{const s=d.style;s.position="absolute",s.width=`${o}px`,s.height=`${o}px`,s.boxSizing="border-box";const a=Math.ceil((h+1)/e);a===1&&(s.top="0px",s.left=`${o*h}px`),a===2&&(s.top=`${o*(h%e)}px`,s.left=`${o*e}px`),a===3&&(s.left=`${this._size-o*(h%e+1)}px`,s.bottom="0px"),a===4&&(s.bottom=`${o*(h%e)}px`,s.left="0px")})}relayoutWheelPrizes(){if(!this._prizes_dom)return;const t=this._prizes_dom.style;t.position="absolute",t.padding="0",t.margin="0",t.left="0",t.top="0",t.boxSizing="border-box",t.width=`${this._size}px`,t.height=`${this._size}px`,t.borderRadius=`${this._size}px`,t.overflow="hidden";const i=Array.from(this._prizes_dom.children),e=360/i.length/2;this._prizes_dom.style.transform=`rotate(${e%360}deg)`,i.forEach((o,d)=>{const h=o,l=h.style,s=Math.min(h.offsetHeight,h.offsetWidth);l.position="absolute",l.width=`${s}px`,l.height=`${s}px`,l.left=`${this._size/2-s/2}px`,l.top=`${this._size/2-s/2}px`,l.transform=`translateY(${(this._size/2-s/2)*-1}px) rotate(${d*360/i.length}deg)`,l.transformOrigin=`${s/2}px ${this._size/2}px `})}relayoutTrigger(){if(!this._trigger_dom)return;const t=Math.min(this._trigger_dom.offsetHeight,this._trigger_dom.offsetWidth),i=this._trigger_dom.style;i.position="absolute",i.width=`${t}px`,i.height=`${t}px`,i.left=`${this._size/2-t/2}px`,i.top=`${this._size/2-t/2}px`}}u=new WeakMap,f=new WeakMap,_=new WeakMap;customElements.define("wc-lottery",x);
