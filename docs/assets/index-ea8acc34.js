var $=Object.defineProperty;var w=(s,e,t)=>e in s?$(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var d=(s,e,t)=>(w(s,typeof e!="symbol"?e+"":e,t),t),b=(s,e,t)=>{if(!e.has(s))throw TypeError("Cannot "+t)};var c=(s,e,t)=>(b(s,e,"read from private field"),t?t.call(s):e.get(s)),p=(s,e,t)=>{if(e.has(s))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(s):e.set(s,t)},g=(s,e,t,i)=>(b(s,e,"write to private field"),i?i.call(s,t):e.set(s,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function t(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(r){if(r.ep)return;r.ep=!0;const o=t(r);fetch(r.href,o)}})();var u,f,_,m;class z extends HTMLElement{constructor(){super();d(this,"_size");d(this,"_prizes_dom");d(this,"_trigger_dom");d(this,"_playing");d(this,"_old_dge",0);p(this,u,void 0);p(this,f,void 0);p(this,_,void 0);p(this,m,void 0);d(this,"roundTimer")}connectedCallback(){this.style.display="block",this.style.position="relative",this._size=Math.min(this.offsetWidth,this.offsetHeight),this._prizes_dom=this.querySelector('[title*="prizes"]'),this._trigger_dom=this.querySelector('[title*="trigger"]'),this.relayout(),g(this,m,new ResizeObserver(([t])=>{const i=t.target;this._size=Math.min(i.offsetWidth,this.offsetHeight),this._playing=!1,this.relayout()})),c(this,m).observe(this),g(this,u,new MutationObserver(t=>{t.forEach(i=>{i.type==="childList"&&console.log("子节点发生变更")})})),c(this,u).observe(this._prizes_dom,{attributes:!0,childList:!0,subtree:!0}),g(this,f,new MutationObserver(t=>{t.forEach(i=>{i.type==="childList"&&console.log("子节点发生变更")})})),c(this,f).observe(this._trigger_dom,{attributes:!0,childList:!0,subtree:!0}),g(this,_,new MutationObserver(([t])=>{t.type==="attributes"&&this.handleAttributes(t.attributeName)})),c(this,_).observe(this,{childList:!1,attributes:!0})}disconnectedCallback(){c(this,u).disconnect(),c(this,f).disconnect()}handleAttributes(t){if(this._playing===!0){console.log("正在抽奖");return}t==="prize"&&this.lotter()}handleEnded(t){this.dispatchEvent(new CustomEvent("ended",{bubbles:!0,composed:!0,detail:t}))}handlePlay(t){this.dispatchEvent(new CustomEvent("play",{bubbles:!0,composed:!0,detail:t}))}lotter(){const t=this.getAttribute("prize");if(t){console.log("开始"),this._playing=!0,this.handlePlay(t);const i=Array.from(this._prizes_dom.children);let r;if(i.some((v,O)=>{v.getAttribute("title")===t&&(r=O)}),r===void 0)return;const n=360/i.length,l=5,h=6;let a=n*r*-1;a+=360*h,a=a+this._old_dge,this._old_dge=(a-a%360)%360,this._prizes_dom.style.transitionDuration=`${l}s`,this._prizes_dom.style.transform=`rotate(${a}deg)`;const y=()=>{this._prizes_dom.style.transitionDuration="0s",this._prizes_dom.style.transform=`rotate(${a%360}deg)`,this.handleEnded(t),this._prizes_dom.removeEventListener("transitionend",y),this._playing=!1,console.log("结束",this._playing)};this._prizes_dom.addEventListener("transitionend",y)}}relayout(){this.relayoutPrizes(),this.relayoutTrigger()}relayoutPrizes(){if(!this._prizes_dom)return;const t=this._prizes_dom.style;t.position="absolute",t.padding="0",t.margin="0",t.left="0",t.top="0",t.boxSizing="border-box",t.width="100%",t.height="100%",t.borderRadius=`${this._size}px`,t.overflow="hidden";const i=Array.from(this._prizes_dom.children);i.forEach((r,o)=>{const n=r,l=n.style,h=Math.min(n.offsetHeight,n.offsetWidth);l.position="absolute",l.width=`${h}px`,l.height=`${h}px`,l.left=`${this._size/2-h/2}px`,l.top=`${this._size/2-h/2}px`,l.transform=`translateY(${(this._size/2-h/2)*-1}px) rotate(${o*360/i.length}deg)`,l.transformOrigin=`${h/2}px ${this._size/2}px `})}relayoutTrigger(){if(!this._trigger_dom)return;const t=Math.min(this._trigger_dom.offsetHeight,this._trigger_dom.offsetWidth),i=this._trigger_dom.style;i.position="absolute",i.width=`${t}px`,i.height=`${t}px`,i.left=`${this._size/2-t/2}px`,i.top=`${this._size/2-t/2}px`}}u=new WeakMap,f=new WeakMap,_=new WeakMap,m=new WeakMap,d(z,"default_props",Object.freeze({}));customElements.define("wc-wheel-lottery",z);
