var w=Object.defineProperty;var O=(s,e,t)=>e in s?w(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var d=(s,e,t)=>(O(s,typeof e!="symbol"?e+"":e,t),t),y=(s,e,t)=>{if(!e.has(s))throw TypeError("Cannot "+t)};var u=(s,e,t)=>(y(s,e,"read from private field"),t?t.call(s):e.get(s)),p=(s,e,t)=>{if(e.has(s))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(s):e.set(s,t)},g=(s,e,t,i)=>(y(s,e,"write to private field"),i?i.call(s,t):e.set(s,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function t(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(r){if(r.ep)return;r.ep=!0;const o=t(r);fetch(r.href,o)}})();var c,f,m,_;class b extends HTMLElement{constructor(){super();d(this,"_size");d(this,"_prizes_dom");d(this,"_trigger_dom");d(this,"_playing");d(this,"_old_dge",0);p(this,c,void 0);p(this,f,void 0);p(this,m,void 0);p(this,_,void 0);d(this,"roundTimer")}connectedCallback(){this.style.display="block",this.style.position="relative",this._size=Math.min(this.offsetWidth,this.offsetHeight),this._prizes_dom=this.querySelector('[title*="prizes"]'),this._trigger_dom=this.querySelector('[title*="trigger"]'),this.relayout(),g(this,_,new ResizeObserver(([t])=>{const i=t.target;this._size=Math.min(i.offsetWidth,this.offsetHeight),this.relayout()})),u(this,_).observe(this),g(this,c,new MutationObserver(t=>{t.forEach(i=>{i.type==="childList"&&console.log("子节点发生变更")})})),u(this,c).observe(this._prizes_dom,{attributes:!0,childList:!0,subtree:!0}),g(this,f,new MutationObserver(t=>{t.forEach(i=>{i.type==="childList"&&console.log("子节点发生变更")})})),u(this,f).observe(this._trigger_dom,{attributes:!0,childList:!0,subtree:!0}),g(this,m,new MutationObserver(([t])=>{t.type==="attributes"&&this.handleAttributes(t.attributeName)})),u(this,m).observe(this,{childList:!1,attributes:!0})}disconnectedCallback(){u(this,c).disconnect(),u(this,f).disconnect()}handleAttributes(t){t==="prize"&&this._playing!==!0&&this.lotter()}handleEnded(t){this._playing=!1,this.dispatchEvent(new CustomEvent("ended",{bubbles:!0,composed:!0,detail:t}))}handlePlay(t){this._playing=!0,this.dispatchEvent(new CustomEvent("play",{bubbles:!0,composed:!0,detail:t}))}lotter(){const t=this.getAttribute("prize");if(t){this.handlePlay(t);const i=Array.from(this._prizes_dom.children);let r;if(i.some((z,v)=>{z.getAttribute("title")===t&&(r=v)}),r===void 0)return;const l=360/i.length,n=5,h=6;let a=l*r*-1;a+=360*h,a=a+this._old_dge,this._old_dge=(a-a%360)%360,this._prizes_dom.style.transitionDuration=`${n}s`,this._prizes_dom.style.transform=`rotate(${a}deg)`,window.clearTimeout(this.roundTimer),this.roundTimer=setTimeout(()=>{this._prizes_dom.style.transitionDuration="0s",this._prizes_dom.style.transform=`rotate(${a%360}deg)`,this.handleEnded(t)},n*1e3+100)}}relayout(){this.relayoutPrizes(),this.relayoutTrigger()}relayoutPrizes(){if(!this._prizes_dom)return;const t=this._prizes_dom.style;t.position="absolute",t.padding="0",t.margin="0",t.left="0",t.top="0",t.boxSizing="border-box",t.width="100%",t.height="100%",t.borderRadius=`${this._size}px`,t.overflow="hidden";const i=Array.from(this._prizes_dom.children);i.forEach((r,o)=>{const l=r,n=l.style,h=Math.min(l.offsetHeight,l.offsetWidth);n.position="absolute",n.width=`${h}px`,n.height=`${h}px`,n.left=`${this._size/2-h/2}px`,n.top=`${this._size/2-h/2}px`,n.transform=`translateY(${(this._size/2-h/2)*-1}px) rotate(${o*360/i.length}deg)`,n.transformOrigin=`${h/2}px ${this._size/2}px `})}relayoutTrigger(){if(!this._trigger_dom)return;const t=Math.min(this._trigger_dom.offsetHeight,this._trigger_dom.offsetWidth),i=this._trigger_dom.style;i.position="absolute",i.width=`${t}px`,i.height=`${t}px`,i.left=`${this._size/2-t/2}px`,i.top=`${this._size/2-t/2}px`}}c=new WeakMap,f=new WeakMap,m=new WeakMap,_=new WeakMap,d(b,"default_props",Object.freeze({}));customElements.define("wc-wheel-lottery",b);
