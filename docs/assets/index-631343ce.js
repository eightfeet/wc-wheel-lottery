var b=Object.defineProperty;var v=(n,o,t)=>o in n?b(n,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[o]=t;var l=(n,o,t)=>(v(n,typeof o!="symbol"?o+"":o,t),t),m=(n,o,t)=>{if(!o.has(n))throw TypeError("Cannot "+t)};var c=(n,o,t)=>(m(n,o,"read from private field"),t?t.call(n):o.get(n)),g=(n,o,t)=>{if(o.has(n))throw TypeError("Cannot add the same private member more than once");o instanceof WeakSet?o.add(n):o.set(n,t)},y=(n,o,t,i)=>(m(n,o,"write to private field"),i?i.call(n,t):o.set(n,t),t);(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const r of e)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function t(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerPolicy&&(r.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?r.credentials="include":e.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(e){if(e.ep)return;e.ep=!0;const r=t(e);fetch(e.href,r)}})();function $(n,o){let t=0;return function(...i){const e=Date.now();if(!(e-t<o))return t=e,n(...i)}}var p,u,f;class w extends HTMLElement{constructor(){super();l(this,"_size");l(this,"_prizes_dom");l(this,"_prizes_dom_style");l(this,"_prizes_child_dom_style");l(this,"_trigger_dom");l(this,"_playing");l(this,"_old_position",0);l(this,"_old_dge",0);l(this,"_transitionDuration",5e3);l(this,"_type","wheel");l(this,"_");l(this,"_default_html");l(this,"_prizes_grid_activeclass");l(this,"_round",6);g(this,p,void 0);g(this,u,void 0);g(this,f,void 0)}getRound(){this._round=Number(this.getAttribute("round"))||this._round}getType(){const t=this.getAttribute("type");this._type=["wheel","grid"].includes(t)?t:"wheel"}getActiveclass(){this._prizes_grid_activeclass=this.getAttribute("activeclass")}init(){this.disconnect(),this.style.display="block",this.style.position="relative",this._size=Math.min(this.offsetWidth,this.offsetHeight),this.style.width=`${this._size}px`,this.style.height=`${this._size}px`,this._prizes_dom=this.querySelector('[title*="prizes"]'),this._trigger_dom=this.querySelector('[title*="trigger"]'),this._prizes_dom_style=this._prizes_dom.getAttribute("style"),this._prizes_child_dom_style=Array.from(this._prizes_dom.children).map(t=>t.getAttribute("style")),this.getActiveclass(),this.getRound(),y(this,f,new ResizeObserver(([t])=>{if(this._playing===!0)return;const i=t.target;this._size=Math.min(i.offsetWidth,this.offsetHeight),this._playing=!1,this.relayout()})),c(this,f).observe(this),y(this,p,new MutationObserver(t=>{this._playing!==!0&&t.forEach(i=>{i.type==="childList"&&this.relayout()})})),c(this,p).observe(this._prizes_dom,{attributes:!0,childList:!0,subtree:!0}),y(this,u,new MutationObserver($(([t])=>{t.type==="attributes"&&this.handleAttributes(t.attributeName)},200))),c(this,u).observe(this,{childList:!1,attributes:!0})}disconnect(){var t,i,e;(t=c(this,p))==null||t.disconnect(),(i=c(this,u))==null||i.disconnect(),(e=c(this,f))==null||e.disconnect()}connectedCallback(){this.init(),this.getType(),this.relayout(),this.handleLoad()}disconnectedCallback(){this.disconnect()}handleAttributes(t){this._playing!==!0&&(t==="prize"&&this.lotter(),t==="type"&&(this._prizes_dom_style&&this._prizes_dom.setAttribute("style",this._prizes_dom_style),this._prizes_child_dom_style&&Array.from(this._prizes_dom.children).map((i,e)=>i.setAttribute("style",this._prizes_child_dom_style[e])),this.init(),this.getType(),this.relayout()),t==="round"&&this.getRound(),t==="activeclass"&&this.getActiveclass())}handleEnded(t){this.dispatchEvent(new CustomEvent("ended",{bubbles:!0,composed:!0,detail:t}))}handlePlay(t){this.dispatchEvent(new CustomEvent("play",{bubbles:!0,composed:!0,detail:t}))}handleLoad(){this.dispatchEvent(new CustomEvent("load",{bubbles:!0,composed:!0}))}wheelLotter({elements:t,prize:i,position:e}){const a=360/t.length,d=`${this._transitionDuration}ms`,h=this._round;let s=a*e*-1;s+=360*h,s=s+this._old_dge,this._old_dge=(s-s%360)%360,this._prizes_dom.style.transitionDuration=d,this._prizes_dom.style.transform=`rotate(${s}deg)`;const _=()=>{this._prizes_dom.style.transitionDuration="0s",this._prizes_dom.style.transform=`rotate(${s%360}deg)`,this.handleEnded(i),this._prizes_dom.removeEventListener("transitionend",_),this._playing=!1};this._prizes_dom.addEventListener("transitionend",_)}gridLotter({elements:t,prize:i,position:e}){const r=t.length,a=this._round;let d=r*a+e,h=300,s=this._old_position;this._old_position=e;const _=()=>{s>=d?(this._playing=!1,this.handleEnded(i),h=300):(s<r*2+this._old_position&&(h>30?(console.log(h),h-=30):h=30),s>d-r*2&&(h+=10),s+=1,t.forEach(z=>z.classList.remove(this._prizes_grid_activeclass)),t[s%t.length].classList.add(this._prizes_grid_activeclass),setTimeout(_,h))};_()}lotter(){const t=this.getAttribute("prize");if(t){this._playing=!0,this.handlePlay(t);const i=Array.from(this._prizes_dom.children);let e;if(i.some((r,a)=>{r.getAttribute("title")===t&&(e=a)}),e===void 0)throw this._playing=!1,new Error("Unable to locate the prize element!");this._type==="grid"&&this.gridLotter({elements:i,position:e,prize:t}),this._type==="wheel"&&this.wheelLotter({elements:i,position:e,prize:t})}}relayout(){this.relayoutPrizes(),this.relayoutTrigger()}relayoutPrizes(){this._type==="wheel"&&this.relayoutWheelPrizes(),this._type==="grid"&&this.relayoutGridPrizes()}relayoutGridPrizes(){if(!this._prizes_dom)return;const t=this._prizes_dom.style;t.position="absolute",t.padding="0",t.margin="0",t.left="0",t.top="0",t.boxSizing="border-box",t.width="100%",t.height="100%",t.overflow="hidden";const i=Array.from(this._prizes_dom.children),e=Math.ceil(i.length/4),r=this._size/(e+1);i.forEach((a,d)=>{const s=a.style;s.position="absolute",s.width=`${r}px`,s.height=`${r}px`,s.boxSizing="border-box";const _=Math.ceil((d+1)/e);_===1&&(s.top="0px",s.left=`${r*d}px`),_===2&&(s.top=`${r*(d%e)}px`,s.left=`${r*e}px`),_===3&&(s.left=`${this._size-r*(d%e+1)}px`,s.bottom="0px"),_===4&&(s.bottom=`${r*(d%e)}px`,s.left="0px")})}relayoutWheelPrizes(){if(!this._prizes_dom)return;const t=this._prizes_dom.style;t.position="absolute",t.padding="0",t.margin="0",t.left="0",t.top="0",t.boxSizing="border-box",t.width=`${this._size}px`,t.height=`${this._size}px`,t.borderRadius=`${this._size}px`,t.overflow="hidden";const i=Array.from(this._prizes_dom.children),e=360/i.length/2;this._prizes_dom.style.transform=`rotate(${e%360}deg)`,i.forEach((r,a)=>{const d=r,h=d.style,s=Math.min(d.offsetHeight,d.offsetWidth);h.position="absolute",h.width=`${s}px`,h.height=`${s}px`,h.left=`${this._size/2-s/2}px`,h.top=`${this._size/2-s/2}px`,h.transform=`translateY(${(this._size/2-s/2)*-1}px) rotate(${a*360/i.length}deg)`,h.transformOrigin=`${s/2}px ${this._size/2}px `})}relayoutTrigger(){if(!this._trigger_dom)return;const t=Math.min(this._trigger_dom.offsetHeight,this._trigger_dom.offsetWidth),i=this._trigger_dom.style;i.position="absolute",i.width=`${t}px`,i.height=`${t}px`,i.left=`${this._size/2-t/2}px`,i.top=`${this._size/2-t/2}px`}}p=new WeakMap,u=new WeakMap,f=new WeakMap;customElements.define("wc-lottery",w);
