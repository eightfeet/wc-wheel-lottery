var $=Object.defineProperty;var w=(s,t,e)=>t in s?$(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var d=(s,t,e)=>(w(s,typeof t!="symbol"?t+"":t,e),e),b=(s,t,e)=>{if(!t.has(s))throw TypeError("Cannot "+e)};var c=(s,t,e)=>(b(s,t,"read from private field"),e?e.call(s):t.get(s)),g=(s,t,e)=>{if(t.has(s))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(s):t.set(s,e)},p=(s,t,e,i)=>(b(s,t,"write to private field"),i?i.call(s,e):t.set(s,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function e(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(r){if(r.ep)return;r.ep=!0;const o=e(r);fetch(r.href,o)}})();var u,f,_,m;class z extends HTMLElement{constructor(){super();d(this,"_size");d(this,"_prizes_dom");d(this,"_trigger_dom");d(this,"_playing");d(this,"_old_dge",0);g(this,u,void 0);g(this,f,void 0);g(this,_,void 0);g(this,m,void 0);d(this,"roundTimer")}connectedCallback(){this.style.display="block",this.style.position="relative",this._size=Math.min(this.offsetWidth,this.offsetHeight),this._prizes_dom=this.querySelector('[title*="prizes"]'),this._trigger_dom=this.querySelector('[title*="trigger"]'),this.relayout(),p(this,m,new ResizeObserver(([e])=>{const i=e.target;this._size=Math.min(i.offsetWidth,this.offsetHeight),console.log("resize 了"),this._playing=!1,this.relayout()})),c(this,m).observe(this),p(this,u,new MutationObserver(e=>{e.forEach(i=>{i.type==="childList"&&console.log("子节点发生变更")})})),c(this,u).observe(this._prizes_dom,{attributes:!0,childList:!0,subtree:!0}),p(this,f,new MutationObserver(e=>{e.forEach(i=>{i.type==="childList"&&console.log("子节点发生变更")})})),c(this,f).observe(this._trigger_dom,{attributes:!0,childList:!0,subtree:!0}),p(this,_,new MutationObserver(([e])=>{e.type==="attributes"&&this.handleAttributes(e.attributeName)})),c(this,_).observe(this,{childList:!1,attributes:!0})}disconnectedCallback(){c(this,u).disconnect(),c(this,f).disconnect()}handleAttributes(e){if(this._playing===!0){console.log("正在抽奖");return}e==="prize"&&this.lotter()}handleEnded(e){this.dispatchEvent(new CustomEvent("ended",{bubbles:!0,composed:!0,detail:e}))}handlePlay(e){this.dispatchEvent(new CustomEvent("play",{bubbles:!0,composed:!0,detail:e}))}lotter(){const e=this.getAttribute("prize");if(e){console.log("开始"),this._playing=!0,this.handlePlay(e);const i=Array.from(this._prizes_dom.children);let r;if(i.some((v,O)=>{v.getAttribute("title")===e&&(r=O)}),r===void 0)return;const n=360/i.length,l=5,h=6;let a=n*r*-1;a+=360*h,a=a+this._old_dge,this._old_dge=(a-a%360)%360,this._prizes_dom.style.transitionDuration=`${l}s`,this._prizes_dom.style.transform=`rotate(${a}deg)`;const y=()=>{this._prizes_dom.style.transitionDuration="0s",this._prizes_dom.style.transform=`rotate(${a%360}deg)`,setTimeout(()=>{this.handleEnded(e),this._prizes_dom.removeEventListener("transitionend",y),this._playing=!1,console.log("结束",this._playing)},200)};this._prizes_dom.addEventListener("transitionend",y)}}relayout(){this.relayoutPrizes(),this.relayoutTrigger()}relayoutPrizes(){if(!this._prizes_dom)return;const e=this._prizes_dom.style;e.position="absolute",e.padding="0",e.margin="0",e.left="0",e.top="0",e.boxSizing="border-box",e.width="100%",e.height="100%",e.borderRadius=`${this._size}px`,e.overflow="hidden";const i=Array.from(this._prizes_dom.children);i.forEach((r,o)=>{const n=r,l=n.style,h=Math.min(n.offsetHeight,n.offsetWidth);l.position="absolute",l.width=`${h}px`,l.height=`${h}px`,l.left=`${this._size/2-h/2}px`,l.top=`${this._size/2-h/2}px`,l.transform=`translateY(${(this._size/2-h/2)*-1}px) rotate(${o*360/i.length}deg)`,l.transformOrigin=`${h/2}px ${this._size/2}px `})}relayoutTrigger(){if(!this._trigger_dom)return;const e=Math.min(this._trigger_dom.offsetHeight,this._trigger_dom.offsetWidth),i=this._trigger_dom.style;i.position="absolute",i.width=`${e}px`,i.height=`${e}px`,i.left=`${this._size/2-e/2}px`,i.top=`${this._size/2-e/2}px`}}u=new WeakMap,f=new WeakMap,_=new WeakMap,m=new WeakMap,d(z,"default_props",Object.freeze({}));customElements.define("wc-wheel-lottery",z);
